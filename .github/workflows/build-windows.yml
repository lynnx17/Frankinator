name: Build Windows

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
      # 1. Checkout code
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Setup Python
      - name: Setup Python 3.14
        uses: actions/setup-python@v4
        with:
          python-version: 3.14

      # 3. Install Poetry en voeg toe aan PATH
      - name: Install Poetry
        shell: pwsh
        run: |
          $installer = "$env:TEMP\install-poetry.py"
          Invoke-WebRequest -Uri https://install.python-poetry.org -OutFile $installer
          python $installer

          # Voeg Poetry toe aan PATH voor alle volgende stappen
          $poetryPath = "$env:USERPROFILE\AppData\Roaming\Python\Scripts"
          echo "$poetryPath" >> $env:GITHUB_PATH

      # 4. Controleer Poetry en installeer dependencies
      - name: Install dependencies
        run: |
          poetry --version
          poetry config virtualenvs.in-project true
          poetry install --no-interaction --no-ansi

      # 5. Build executable met PyInstaller
      - name: Build executable
        run: poetry run pyinstaller --onefile frankinator.py

      # 6. Upload artifact
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: Frankinator-Windows
          path: dist/*.exe
